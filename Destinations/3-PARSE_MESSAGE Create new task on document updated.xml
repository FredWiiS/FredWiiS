<connector version="3.4.2">
  <metaDataId>134</metaDataId>
  <name>Create new task on document updated</name>
  <properties class="com.mirth.connect.connectors.jdbc.DatabaseDispatcherProperties" version="3.4.2">
    <pluginProperties/>
    <destinationConnectorProperties version="3.4.2">
      <queueEnabled>false</queueEnabled>
      <sendFirst>false</sendFirst>
      <retryIntervalMillis>10000</retryIntervalMillis>
      <regenerateTemplate>false</regenerateTemplate>
      <retryCount>0</retryCount>
      <rotate>false</rotate>
      <includeFilterTransformer>false</includeFilterTransformer>
      <threadCount>1</threadCount>
      <threadAssignmentVariable></threadAssignmentVariable>
      <validateResponse>false</validateResponse>
      <resourceIds class="linked-hash-map">
        <entry>
          <string>Default Resource</string>
          <string>[Default Resource]</string>
        </entry>
      </resourceIds>
      <queueBufferSize>1000</queueBufferSize>
    </destinationConnectorProperties>
    <driver>com.mysql.jdbc.Driver</driver>
    <url>${database_url}</url>
    <username>${database_login}</username>
    <password>Dyn@mic69</password>
    <query>INSERT INTO bea.task(action, parameters)
SELECT &apos;DOCUMENT_SCANNED&apos;, id
FROM bea.document
WHERE study_id = (SELECT id FROM study WHERE study_instance_uid = ${study_instance_uid} LIMIT 1);</query>
    <useScript>false</useScript>
  </properties>
  <transformer version="3.4.2">
    <steps/>
    <inboundTemplate encoding="base64"></inboundTemplate>
    <inboundDataType>JSON</inboundDataType>
    <outboundDataType>JSON</outboundDataType>
    <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.4.2">
      <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.4.2">
        <splitType>JavaScript</splitType>
        <batchScript></batchScript>
      </batchProperties>
    </inboundProperties>
    <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.4.2">
      <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.4.2">
        <splitType>JavaScript</splitType>
        <batchScript></batchScript>
      </batchProperties>
    </outboundProperties>
  </transformer>
  <responseTransformer version="3.4.2">
    <steps/>
    <inboundDataType>JSON</inboundDataType>
    <outboundDataType>JSON</outboundDataType>
    <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.4.2">
      <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.4.2">
        <splitType>JavaScript</splitType>
        <batchScript></batchScript>
      </batchProperties>
    </inboundProperties>
    <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.4.2">
      <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.4.2">
        <splitType>JavaScript</splitType>
        <batchScript></batchScript>
      </batchProperties>
    </outboundProperties>
  </responseTransformer>
  <filter version="3.4.2">
    <rules>
      <rule>
        <sequenceNumber>0</sequenceNumber>
        <name>Accept message if &quot;$(&apos;updateStudyIdInDocument&apos;)&quot; equals 1</name>
        <data>
          <entry>
            <string>Field</string>
            <string>$(&apos;updateStudyIdInDocument&apos;)</string>
          </entry>
          <entry>
            <string>Name</string>
            <string></string>
          </entry>
          <entry>
            <string>OriginalField</string>
            <string></string>
          </entry>
          <entry>
            <string>Equals</string>
            <string>1</string>
          </entry>
          <entry>
            <string>Values</string>
            <list>
              <string>1</string>
            </list>
          </entry>
        </data>
        <type>Rule Builder</type>
        <script>if($(&apos;updateStudyIdInDocument&apos;) == 1) {
	return true;
}
return false;</script>
        <operator>NONE</operator>
      </rule>
    </rules>
  </filter>
  <transportName>Database Writer</transportName>
  <mode>DESTINATION</mode>
  <enabled>true</enabled>
  <waitForPrevious>true</waitForPrevious>
</connector>